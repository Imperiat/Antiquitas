namespace = dhe_massalia

dhe_massalia.1 = {					### Rise of the Salyes - Start
	type = country_event
	title = "dhe_massalia.1.t"
	desc = "dhe_massalia.1.desc"
	picture = celtic_chiefs
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_slv_ruler

	fire_only_once = yes

	goto_location = scope:dhe_massalia_slv_ruler.employer.capital_scope

	trigger = {
		tag = MAS
		has_land = yes
		is_subject = no
		any_neighbour_country = {
			num_of_cities >= root.num_of_cities
			country_culture_group = gallic
			NOR = { 
				war_with = root 
				alliance_with = root
			}
		}
		NOT = {
			c:SLV = {
				any_owned_province = {
					any_neighbor_province = { owner = root }
				}
				num_of_cities >= root.num_of_cities
				war_with = root
			}
		}
	}
	
	immediate = {
		current_ruler = { save_scope_as = dhe_massalia_mas_ruler }
		if = {
			limit = {
				any_neighbour_country = {
					this = c:SLV
					num_of_cities >= root.num_of_cities
					country_culture_group = gallic
					NOR = { 
						war_with = root 
						alliance_with = root
					}
				}
			}
			c:SLV = {
				current_ruler = { save_scope_as = dhe_massalia_slv_ruler }
			}
		}
		else = {
			ordered_neighbour_country = {
				limit = {
					num_of_cities >= root.num_of_cities
					country_culture_group = gallic
					NOR = { 
						war_with = root 
						alliance_with = root
					}
				}
				order_by = num_of_cities
				current_ruler = { save_scope_as = dhe_massalia_slv_ruler }
			}
		}
	}
	
	option = {					# Pre-emptive strike
		name = "dhe_massalia.1.a"
		hidden_effect = {
			scope:dhe_massalia_slv_ruler.employer = {
				every_owned_province = {
					limit = {
						any_neighbor_province = { 
							owner = c:MAS
						}
					}
					add_claim = MAS
				}
			}
		}
		custom_tooltip = dhe_massilia.1.at
		add_aggressive_expansion = 7.5
		ai_chance = { 
			factor = 20
		}
	}
	
	option = {					# Win them over with more symmetrical trading
		name = "dhe_massalia.1.b"
		current_ruler = { add_popularity = subtract_popularity_medium }
		add_treasury = {
			value = has_monthly_income
			multiply = -3
		}
		custom_tooltip = dhe_massalia.1.bt
		show_as_tooltip = {
			add_country_modifier = {
				name = dhe_massalia_fair_trading_practices_cmod
				duration = 3650 # 10 years
			}
			add_opinion = { target = scope:dhe_massalia_slv_ruler.employer modifier = opinion_dhe_massalia_friendship }
			reverse_add_opinion = { target = scope:dhe_massalia_slv_ruler.employer modifier = opinion_dhe_massalia_friendship }
		}
		scope:dhe_massalia_slv_ruler.employer = {
			trigger_event = {
				id = dhe_massalia.2
				days = 1
			}
		}
		ai_chance = { 
			factor = 20
		}
	}
}

dhe_massalia.2 = {					# Rise of the Salyes - Offer from MAS
	type = country_event
	title = "dhe_massalia.2.t"
	desc = "dhe_massalia.2.desc"
	picture = celtic_chiefs
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_mas_ruler
	
	goto_location = scope:dhe_massalia_mas_ruler.employer.capital_scope
	
	trigger = {
		NOT = { war_with = scope:dhe_massalia_mas_ruler.employer }
	}
	
	option = {					# Accept
		name = "dhe_massalia.2.a"
		current_ruler = { add_popularity = subtract_popularity_medium }
		c:MAS = {
			trigger_event = {
				id = dhe_massalia.3
				days = 1
			}
		}
		add_country_modifier = {
			name = dhe_massalia_trade_access_cmod
			duration = 3650 # 10 years
		}
		show_as_tooltip = {
			add_opinion = { target = scope:dhe_massalia_mas_ruler.employer modifier = opinion_dhe_massalia_friendship }
			reverse_add_opinion = { target = scope:dhe_massalia_mas_ruler.employer modifier = opinion_dhe_massalia_friendship }
		}
		ai_chance = { 
			factor = 50
		}
	}
	
	option = {					# Demand tribute
		name = "dhe_massalia.2.b"
		trigger = {
			c:MAS = { is_subject = no }
		}
		custom_tooltip = dhe_massalia.2.bt
		current_ruler = { add_popularity = popularity_small }
		hidden_effect  = {
			c:MAS.capital_scope = { 
				add_claim = root 
			}
		}
		c:MAS = {
			set_variable = {
				name = dhe_massalia_tribute_flag
				value = 0
			}
			trigger_event = {
				id = dhe_massalia.3
				days = 1
			}
		}
		ai_chance = { 
			factor = 30
			modifier = {
				factor = 60
				opinion = { target = c:MAS value < 30 }
				opinion = { target = c:MAS value > -30 }
			}
		}
	}
	
	option = {					# Reject
		name = "dhe_massalia.2.c"
		custom_tooltip = dhe_massalia.2.ct
		current_ruler = { add_popularity = popularity_large }
		hidden_effect = {
			scope:dhe_massalia_slv_ruler.employer = {
				every_owned_province = {
					limit = {
						any_neighbor_province = { 
							owner = root
						}
					}
					add_claim = root
				}
			}
		}
		c:MAS = {
			set_variable = {
				name = dhe_massalia_reject_flag
			}
			trigger_event = {
				id = dhe_massalia.3
				days = 1
			}
		}
		ai_chance = { 
			factor = 20
			modifier = {
				factor = 60
				opinion = { target = c:MAS value < -30 }
			}
		}
	}
}

dhe_massalia.3 = {					# Rise of the Salyes - Response from SLV
	type = country_event
	title = "dhe_massalia.3.t"
	desc = {
		first_valid = {
			triggered_desc = {		# Rejected
				trigger = {
					has_variable = dhe_massalia_reject_flag
				}
				desc = "dhe_massalia.3.desc_1"
			}
			triggered_desc = {		# Tribute
				trigger = {
					has_variable = dhe_massalia_tribute_flag
				}
				desc = "dhe_massalia.3.desc_2"
			}
			triggered_desc = {		# Accept
				trigger = {
					always = yes
				}
				desc = "dhe_massalia.3.desc_3"
			}
		}
	}
	picture = council_country
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_slv_ruler
	
	goto_location = scope:dhe_massalia_slv_ruler.employer.capital_scope
	
	trigger = {
		NOT = { war_with = scope:dhe_massalia_slv_ruler.employer }
	}
	
	immediate = {
		if = {
			limit = {
				has_variable = dhe_massalia_reject_flag
			}
			show_as_tooltip = {
				root = {
					every_owned_province = {
						limit = {
							any_neighbor_province = { 
								owner = scope:dhe_massalia_slv_ruler.employer
							}
						}
						add_claim = scope:dhe_massalia_slv_ruler.employer
					}
				}
			}	
		}
	}
	
	option = {					# Accepted
		name = "dhe_massalia.3.a"
		trigger = {
			NOR = { 
				has_variable = dhe_massalia_tribute_flag
				has_variable = dhe_massalia_reject_flag
			}
		}
		add_opinion = { target = scope:dhe_massalia_slv_ruler.employer modifier = opinion_dhe_massalia_friendship }
		reverse_add_opinion = { target = scope:dhe_massalia_slv_ruler.employer modifier = opinion_dhe_massalia_friendship }
		add_country_modifier = {
			name = dhe_massalia_fair_trading_practices_cmod
			duration = 3650 # 10 years
		}
	}
	
	option = {					# Accept tribute
		name = "dhe_massalia.3.b"
		trigger = {
			has_variable = dhe_massalia_tribute_flag
		}
		current_ruler = { add_popularity = subtract_popularity_huge }
		scope:dhe_massalia_slv_ruler.employer = {
			make_subject = {
				target = root
				type = tributary
			}
		}
		add_country_modifier = {
			name = dhe_massalia_tribute_cmod
			duration = 3650 # 10 years
		}
		scope:dhe_massalia_slv_ruler.employer = {
			trigger_event = {
				id = dhe_massalia.4
				days = 5
			}
		}
		hidden_effect  = {
			c:MAS.capital_scope = { 
				remove_claim = scope:dhe_massalia_slv_ruler.employer 
			}
		}
	}
	
	option = {					# Refuse tribute
		name = "dhe_massalia.3.c"
		trigger = {
			has_variable = dhe_massalia_tribute_flag
		}
		change_variable = {
			name = dhe_massalia_tribute_flag
			add = 1
		}
		current_ruler = { add_popularity = popularity_large }
		hidden_effect = {
			scope:dhe_massalia_slv_ruler.employer = {
				every_owned_province = {
					limit = {
						any_neighbor_province = { 
							owner = c:MAS
						}
					}
					add_claim = MAS
				}
			}
		}
		scope:dhe_massalia_slv_ruler.employer = {
			trigger_event = {
				id = dhe_massalia.4
				days = 5
			}
		}
		custom_tooltip = dhe_massalia.3.ct
	}
	
	option = {					# Rejected
		name = "dhe_massalia.3.d"
		trigger = {
			has_variable = dhe_massalia_reject_flag
		}
		root = {
			every_owned_province = {
				limit = {
					any_neighbor_province = { 
						owner = scope:dhe_massalia_slv_ruler.employer
					}
				}
				add_claim = root
			}
		}
	}
}

dhe_massalia.4 = {					# Rise of the Salyes - Info on MAS decision
	type = country_event
	title = "dhe_massalia.4.t"
	desc = {
		first_valid = {
			triggered_desc = {		# Rejected
				trigger = {
					c:MAS = { var:dhe_massalia_tribute_flag = 1 }
				}
				desc = "dhe_massalia.4.desc_1"
			}
			triggered_desc = {		# Tribute
				trigger = {
					c:MAS = { var:dhe_massalia_tribute_flag = 0 }
				}
				desc = "dhe_massalia.4.desc_2"
			}
		}
	}
	picture = celtic_chiefs
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_mas_ruler
	
	goto_location = scope:dhe_massalia_mas_ruler.employer.capital_scope
	
	trigger = {
		c:MAS = { has_variable = dhe_massalia_tribute_flag }
		NOT = { war_with = scope:dhe_massalia_mas_ruler.employer }
	}
	
	immediate = {
		if = {
			limit = {
				has_variable = dhe_massalia_tribute_flag
				c:MAS = { var:dhe_massalia_tribute_flag = 0 }
			}
			show_as_tooltip = {
				scope:dhe_massalia_slv_ruler.employer = {
					make_subject = {
						target = root
						type = tributary
					}
				}
			}
		}
	}
	
	option = {					# War
		name = "dhe_massalia.4.a"
		trigger = {
			c:MAS = { var:dhe_massalia_tribute_flag = 1 }
		}
		declare_war_with_wargoal = {
			war_goal = conquer_wargoal
			province = 2325
			target = MAS
		}
	}
	
	option = {					# Not yet
		name = "dhe_massalia.4.b"
		trigger = {
			c:MAS = { var:dhe_massalia_tribute_flag = 1 }
		}
		current_ruler = { add_popularity = subtract_popularity_large }
		every_character = {
			limit = {
				is_clan_chief = yes
			}
			add_loyalty = loyalty_cowardly_chief
		}
	}
	
	option = {					# Massilian tribute
		name = "dhe_massalia.4.c"
		trigger = {
			c:MAS = { var:dhe_massalia_tribute_flag = 0 }
		}
		current_ruler = { add_popularity = popularity_large }
		every_character = {
			limit = {
				is_clan_chief = yes
			}
			add_loyalty = loyalty_subjected_massalians
		}
	}
}

dhe_massalia.10 = {						# Roman Friends - Roman-Carthaginian War
	type = country_event
	title = "dhe_massalia.10.t"
	desc = "dhe_massalia.10.desc"
	picture = naval_battle
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_rome_scope.current_ruler
	
	goto_location = scope:dhe_massalia_rome_scope.capital_scope 
	
	fire_only_once = yes
	
	trigger = {
		tag = MAS
		has_land = yes
		num_of_cities > 1
		num_of_ports >= 1
		opinion = { target = ROM value >= -25 }
		opinion = { target = CAR value <= 25 }
		c:CAR = {
			has_land = yes
			NOR = {
				war_with = c:MAS
				alliance_with = c:MAS
				opinion = { target = MAS value >= 50 }
			}
		}
		OR = {
			c:ROM = { 
				has_land = yes
				in_diplomatic_range = root
				capital_scope = { 
					is_in_region = central_italy_region
				}
				num_of_cities >= 50
				num_of_ports >= 1
				num_of_ships > 1
				war_with = c:CAR
				num_of_ships <= c:CAR.num_of_ships
				num_of_cities <= c:CAR.num_of_cities
				OR = {
					OR = {
						is_republic = yes
						is_monarchy = yes
					}
					capital_scope = { civilization_value >= 30 }
				}
				NOR = { 
					war_with = c:MAS
					alliance_with = c:MAS
					opinion = { target = ROM value <= -50 } 
				}
			}
			any_country = { # Fallback
				has_land = yes
				in_diplomatic_range = root
				num_of_cities >= 50
				num_of_ports >= 1
				num_of_ships > 1
				war_with = c:CAR
				num_of_ships <= c:CAR.num_of_ships
				num_of_cities <= c:CAR.num_of_cities
				OR = {
					OR = {
						is_republic = yes
						is_monarchy = yes
					}
					capital_scope = { civilization_value >= 30 }
				}
				NOR = {
					war_with = c:MAS
					alliance_with = c:MAS
					opinion = { target = ROM value <= -50 } 
					this = c:ROM
					this = c:CAR
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				c:ROM = { 
					has_land = yes
					in_diplomatic_range = root
					capital_scope = { 
						is_in_region = central_italy_region
					}
					num_of_cities >= 50
					num_of_ports >= 1
					num_of_ships > 1
					war_with = c:CAR
					num_of_ships <= c:CAR.num_of_ships
					OR = {
						OR = {
							is_republic = yes
							is_monarchy = yes
						}
						capital_scope = { civilization_value >= 30 }
					}
					NOR = { 
						war_with = c:MAS
						alliance_with = c:MAS
						opinion = { target = ROM value <= -50 } 
					}
				}
			}
			c:ROM = { save_scope_as = dhe_massalia_rome_scope }
		}
		else = {
			random_country = {
				limit = {
					has_land = yes
					in_diplomatic_range = root
					num_of_cities >= 50
					num_of_ports >= 1
					num_of_ships > 1
					war_with = c:CAR
					num_of_ships <= c:CAR.num_of_ships
					OR = {
						OR = {
							is_republic = yes
							is_monarchy = yes
						}
						capital_scope = { civilization_value >= 30 }
					}
					NOR = {
						war_with = c:MAS
						alliance_with = c:MAS
						opinion = { target = ROM value <= -50 } 
						this = c:ROM
						this = c:CAR
					}
				}
				save_scope_as = dhe_massalia_rome_scope
			}
		}
		c:CAR = { save_scope_as = dhe_massalia_carthage_scope }
	}
	
	option = {					# Yes
		name = "dhe_massalia.10.a"
		custom_tooltip = dhe_massalia.10.at1
		show_as_tooltip = {
			add_treasury = {
				value = scope:dhe_massalia_rome_scope.has_monthly_income
				multiply = 2
			}
			custom_tooltip = dhe_massalia.10.at2
			reverse_add_opinion = { target = scope:dhe_massalia_rome_scope modifier = dhe_massalia_ship_aid_opmod }
			add_opinion = { target = scope:dhe_massalia_rome_scope modifier = dhe_massalia_ship_aid_opmod }
		}
		scope:dhe_massalia_rome_scope = {
			trigger_event = {
				id = dhe_massalia.11
				days = 5
			}
		}
		ai_chance = { factor = 100 }
	}
	
	option = {					# No
		name = "dhe_massalia.10.b"
		current_ruler = { add_popularity = subtract_popularity_medium }
		ai_chance = { factor = 0 }
	}
}

dhe_massalia.11 = {						# Roman Friends - Offer from Massilia
	type = country_event
	title = "dhe_massalia.11.t"
	desc = "dhe_massalia.11.desc"
	picture = naval_battle
	
	left_portrait = current_ruler
	right_portrait = c:MAS.current_ruler
	
	goto_location =  c:MAS.capital_scope
	
	fire_only_once = yes
	
	trigger = {
		has_land = yes
		num_of_cities >= 50
		num_of_ports >= 1
		num_of_ships <= c:CAR.num_of_ships
		war_with = c:CAR
		c:MAS = {
			has_land = yes
			num_of_ports >= 1
		}
		in_diplomatic_range = c:MAS
		c:CAR = {
			has_land = yes
			num_of_cities >= root.num_of_cities
			NOR = {
				war_with = c:MAS
				alliance_with = c:MAS
				opinion = { target = MAS value >= 50 }
			}
		}
	}
	
	immediate = {
		scope:dhe_massalia_rome_scope = {
			random_navy = {
				weight = {
					modifier = {
						factor = 100
						unit_size > 5
					}
				}
				save_scope_as = dhe_massalia_purchase_navy_scope
			}
		}
	}
	
	option = {					# Accept
		name = "dhe_massalia.11.a"
		add_treasury = {
			value = has_monthly_income
			multiply = -2
		}
		hidden_effect = {
			scope:dhe_massalia_purchase_navy_scope = {
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme

			}
		}
		custom_tooltip = dhe_massalia.11.at
		reverse_add_opinion = { target = c:MAS modifier = dhe_massalia_ship_aid_opmod }
		add_opinion = { target = c:MAS modifier = dhe_massalia_ship_aid_opmod }
		set_variable = {
			name = dhe_massalia_carthage_aid_rom_flag
		}
		scope:dhe_massalia_rome_scope = {
			trigger_event = {
				id = dhe_massalia.12
				days = 5
			}
		}
		ai_chance = { factor = 60 }
	}
	
	option = {					# Buy double!
		name = "dhe_massalia.11.b"
		add_treasury = {
			value = has_monthly_income
			multiply = -4
		}
		hidden_effect = {
			scope:dhe_massalia_purchase_navy_scope = {
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = liburnian
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme
				add_subunit = trireme

			}
		}
		custom_tooltip = dhe_massalia.11.bt
		reverse_add_opinion = { target = c:MAS modifier = dhe_massalia_ship_aid_opmod }
		add_opinion = { target = c:MAS modifier = dhe_massalia_ship_aid_opmod }
		set_variable = {
			name = dhe_massalia_carthage_aid_rom_flag
		}
		c:MAS = { 
			set_variable = dhe_massalia_double_ship_flag
			trigger_event = {
				id = dhe_massalia.12
				days = 5
			}
		}
		ai_chance = { factor = 40 }
	}
	
	option = {					# No
		name = "dhe_massalia.11.c"
		custom_tooltip = tooltip_no_effect
		c:MAS = { 
			set_variable = dhe_massalia_rejected_ship_flag
			trigger_event = {
				id = dhe_massalia.12
				days = 5
			}
		}
		ai_chance = { factor = 0 }
	}
}

dhe_massalia.12 = {						# Roman Friends - Roman Response
	type = country_event
	title = "dhe_massalia.12.t"
	desc = {
		first_valid = {
			triggered_desc = {		# Rejected
				trigger = {
					has_variable = dhe_massalia_rejected_ship_flag
				}
				desc = "dhe_massalia.12.desc_1"
			}
			triggered_desc = {		# Double
				trigger = {
					has_variable = dhe_massalia_double_ship_flag
				}
				desc = "dhe_massalia.12.desc_2"
			}
			triggered_desc = {		# Accept
				trigger = {
					always = yes
				}
				desc = "dhe_massalia.12.desc_3"
			}
		}
	}
	picture = naval_battle
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_rome_scope.current_ruler
	
	goto_location = scope:dhe_massalia_rome_scope.capital_scope
	
	fire_only_once = yes
	
	trigger = {
		has_land = yes
		num_of_ports >= 1
		scope:dhe_massalia_rome_scope = {
			has_land = yes
			num_of_cities >= 50
			num_of_ports >= 1
			num_of_ships <= c:CAR.num_of_ships
			war_with = c:CAR
			in_diplomatic_range = c:MAS
		}
		c:CAR = {
			has_land = yes
			num_of_cities >= scope:dhe_massalia_rome_scope.num_of_cities
			NOR = {
				war_with = c:MAS
				alliance_with = c:MAS
				opinion = { target = MAS value >= 50 }
			}
		}
	}
	
	immediate = {
		if = {
			limit = { has_variable = dhe_massalia_double_ship_flag }
			custom_tooltip = dhe_massalia.11.bt
		}
		else = {
			custom_tooltip = dhe_massalia.11.at
		}
		if = {
			limit = { 
				NOT = { has_variable = dhe_massalia_rejected_ship_flag }
			}
			show_as_tooltip = {
				reverse_add_opinion = { target = scope:dhe_massalia_rome_scope modifier = dhe_massalia_ship_aid_opmod }
				add_opinion = { target = scope:dhe_massalia_rome_scope modifier = dhe_massalia_ship_aid_opmod }
			}
			set_variable = {
				name = dhe_massalia_carthage_aid_mas_flag
			}
		}
	}
	
	option = {					# Accepted
		name = "dhe_massalia.12.a"
		trigger = { 
			NOR = { 
				has_variable = dhe_massalia_double_ship_flag
				has_variable = dhe_massalia_rejected_ship_flag
			}
		}
		add_treasury = {
			value = scope:dhe_massalia_rome_scope.has_monthly_income
			multiply = 2
		}
		scope:dhe_massalia_rome_scope = {
			trigger_event = {
				id = dhe_massalia.11
				days = 5
			}
		}
	}
	
	option = {					# Bought double!
		name = "dhe_massalia.12.b"
		trigger = {
			has_variable = dhe_massalia_double_ship_flag
		}
		add_treasury = {
			value = scope:dhe_massalia_rome_scope.has_monthly_income
			multiply = 4
		}
		add_country_modifier = {
			name = dhe_massalia_invigorated_shipyards_cmod
			duration = 3650 # 10 years
		}
		remove_variable = dhe_massalia_double_ship_flag
	}
	
	option = {					# Rejected
		name = "dhe_massalia.12.c"
		trigger = {
			has_variable = dhe_massalia_rejected_ship_flag
		}
		current_ruler = { add_popularity = subtract_popularity_small }
		remove_variable = dhe_massalia_rejected_ship_flag
	}
}

dhe_massalia.13 = {						# Roman Friends - MAS Needs Aid
	type = country_event
	title = "dhe_massalia.13.t"
	desc = "dhe_massalia.13.desc"
	picture = greeks_marching
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_rome_scope.current_ruler
	
	goto_location = scope:dhe_massalia_rome_scope.capital_scope
	
	trigger = {
		tag = MAS
		has_land = yes
		has_variable = dhe_massalia_carthage_aid_mas_flag
		war = yes
		any_neighbour_country = {
			war_with = root
			NOT = { has_variable = dhe_massalia_carthage_aid_rom_flag }
		}
		any_country = {
			in_diplomatic_range = c:MAS
			has_variable = dhe_massalia_carthage_aid_rom_flag
			NOR = { 
				war_with = c:MAS
				opinion = { target = ROM value <= -50 } 
			}
		}
		NOT = { has_variable = dhe_massalia_rome_aid_cooldown }
	}
	
	immediate = {
		set_variable = {
			name = dhe_massalia_rome_aid_cooldown
			days = 1825 # 5 years
		}
		random_country = {
			limit = {
				in_diplomatic_range = c:MAS
				has_variable = dhe_massalia_carthage_aid_rom_flag
				NOR = { 
					war_with = c:MAS
					opinion = { target = ROM value <= -50 } 
				}
			}
			save_scope_as = dhe_massalia_rome_scope
		}
		ordered_neighbour_country = {
			limit = {
				war_with = root
			}
			order_by = num_of_cities
			save_scope_as = dhe_massalia_war_scope
		}
	}
	
	option = {					# Ask for aid
		name = "dhe_massalia.13.a"
		custom_tooltip = dhe_massalia.13.at
		scope:dhe_massalia_rome_scope = {
			trigger_event = {
				id = dhe_massalia.14
				days = 5
			}
			remove_variable = dhe_massalia_carthage_aid_rom_flag
		}
		remove_variable = dhe_massalia_carthage_aid_mas_flag
		ai_chance = { factor = 100 }
	}
	
	option = {					# No aid needed
		name = "dhe_massalia.13.b"
		current_ruler = { add_popularity = popularity_small }
		custom_tooltip = dhe_massalia.13.bt
		ai_chance = { factor = 0 }
	}
}

dhe_massalia.14 = {						# Roman Friends - MAS Needs Aid
	type = country_event
	title = "dhe_massalia.14.t"
	desc = "dhe_massalia.14.desc"
	picture = greeks_marching
	
	left_portrait = current_ruler
	right_portrait = c:MAS.current_ruler
	
	goto_location = c:MAS.capital_scope
	
	fire_only_once = yes
	
	option = {					# War
		name = "dhe_massalia.14.a"
		current_ruler = { add_popularity = popularity_medium }
		c:MAS = {
			trigger_event = {
				id = dhe_massalia.15
				days = 5
			}
		}
		hidden_effect = {
			scope:dhe_massalia_war_scope.capital_scope = {
				add_claim = root
			}
		}
		show_as_tooltip = {
			c:MAS = {
				add_opinion = { target = root modifier = dhe_massalia_aid_opmod }
			}
		}
		declare_war_with_wargoal = {
			war_goal = conquer_wargoal
			province = scope:dhe_massalia_war_scope.capital_scope
			target = scope:dhe_massalia_war_scope
		}
		ai_chance = { factor = 60 }
	}
	
	option = {					# Send troops
		name = "dhe_massalia.14.b"
		current_ruler = { add_popularity = subtract_popularity_small }
		add_manpower = -5
		show_as_tooltip = {
			c:MAS = {
				add_opinion = { target = root modifier = dhe_massalia_aid_men_opmod }
			}
		}
		c:MAS = {
			set_variable = dhe_massalia_rome_troops_flag
			trigger_event = {
				id = dhe_massalia.15
				days = 5
			}
		}
		ai_chance = { factor = 40 }
	}
	
	option = {					# No aid
		name = "dhe_massalia.14.c"
		current_ruler = { add_popularity = subtract_popularity_medium }
		show_as_tooltip = {
			c:MAS = {
				add_opinion = { target = root modifier = dhe_massalia_refused_aid_opmod }
			}
		}
		c:MAS = {
			set_variable = dhe_massalia_rome_reject_flag
			trigger_event = {
				id = dhe_massalia.15
				days = 5
			}
		}
		ai_chance = { factor = 0 }
	}
}

dhe_massalia.15 = {						# Roman Friends - ROM Response
	type = country_event
	title = "dhe_massalia.15.t"
	desc = {
		first_valid = {
			triggered_desc = {		# Rejected
				trigger = {
					has_variable = dhe_massalia_rome_reject_flag
				}
				desc = "dhe_massalia.15.desc_1"
			}
			triggered_desc = {		# troops
				trigger = {
					has_variable = dhe_massalia_rome_troops_flag
				}
				desc = "dhe_massalia.15.desc_2"
			}
			triggered_desc = {		# War
				trigger = {
					always = yes
				}
				desc = "dhe_massalia.15.desc_3"
			}
		}
	}
	picture = council_country
	
	left_portrait = current_ruler
	right_portrait = scope:dhe_massalia_rome_scope.current_ruler
	
	goto_location = scope:dhe_massalia_rome_scope.capital_scope
	
	fire_only_once = yes
	
	immediate = {
		if = {
			limit = {
				NOR = {
					has_variable = dhe_massalia_rome_troops_flag
					has_variable = dhe_massalia_rome_reject_flag
				}
			}
			show_as_tooltip = {
				scope:dhe_massalia_rome_scope = {
					declare_war_with_wargoal = {
						war_goal = conquer_wargoal
						province = scope:dhe_massalia_war_scope.capital_scope
						target = scope:dhe_massalia_war_scope
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = dhe_massalia_rome_troops_flag
			}
			if = {
				limit = { 
					manpower_percentage < 80
				}
				add_manpower = 5
			}
			else = {
				add_country_modifier = {
					name = dhe_massalia_foreign_aid_cmod
					duration = 3650 # 10 years
				}
			}
		}
		random_country = {
			limit = {
				in_diplomatic_range = c:MAS
				has_variable = dhe_massalia_carthage_aid_rom_flag
			}
			save_scope_as = dhe_massalia_rome_scope
		}
	}
	
	option = {					# Ask for aid
		name = "dhe_massalia.15.a"
		trigger = {
			NOR = {
				has_variable = dhe_massalia_rome_troops_flag
				has_variable = dhe_massalia_rome_reject_flag
			}
		}
		add_opinion = { target = scope:dhe_massalia_rome_scope modifier = dhe_massalia_aid_opmod }
	}
	
	option = {					# No aid needed
		name = "dhe_massalia.15.b"
		trigger = {
			has_variable = dhe_massalia_rome_troops_flag
		}
		add_opinion = { target = scope:dhe_massalia_rome_scope modifier = dhe_massalia_aid_men_opmod }
	}
	
	option = {					# No aid needed
		name = "dhe_massalia.15.b"
		trigger = {
			has_variable = dhe_massalia_rome_reject_flag
		}
		add_opinion = { target = scope:dhe_massalia_rome_scope modifier = dhe_massalia_refused_aid_opmod }
	}
}

dhe_massalia.16 = {						# Pytheas departs ping
	type = country_event
	title = "dhe_massalia.16.t"
	desc = "dhe_massalia.16.desc"
	
	picture = ship_in_storm
	
	left_portrait = current_ruler
	right_portrait = c:MAS.current_ruler
	
	option = {					# Ok
		name = "dhe_massalia.16.a"
	}
}

dhe_massalia.17 = {						# Pytheas spotted ping
	type = country_event
	title = "dhe_massalia.17.t"
	desc = "dhe_massalia.17.desc"
	picture = ship_in_storm
	
	left_portrait = current_ruler
	
	option = {					# Ok
		name = "dhe_massalia.17.a"
	}
}